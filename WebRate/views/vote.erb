<script>
  function addSite (site_path) {
      num_sites += 1;

      //Form entry for First Place
      var option1 = document.createElement('option');
      option1.setAttribute('id', 'site' + num_sites + '-1'); // assign an id
      option1.setAttribute('value', site_path);
      var t1 = document.createTextNode("Website "+num_sites);
      option1.appendChild(t1);

      //Form entry for Second Place
      var option2 = document.createElement('option');
      option2.setAttribute('id', 'site' + num_sites + '-2'); // assign an id
      option2.setAttribute('value', site_path);
      var t2 = document.createTextNode("Website "+num_sites);
      option2.appendChild(t2);

      //Form entry for Third Place
      var option3 = document.createElement('option');
      option3.setAttribute('id', 'site' + num_sites + '-3'); // assign an id
      option3.setAttribute('value', site_path);
      var t3 = document.createTextNode("Website "+num_sites);
      option3.appendChild(t3);

      //Append each option onto the appropriate form
      var form1 = document.getElementById('vote-1');
      form1.appendChild(option1);
      var form2 = document.getElementById('vote-2');
      form2.appendChild(option2);
      var form3 = document.getElementById('vote-3');
      form3.appendChild(option3);

      //Create the iframe title
      var iframename = document.createElement('H2');
      var t = document.createTextNode('Website '+num_sites+' - "'+site_path.slice(14).slice(0,-5)+'"');
      iframename.appendChild(t);

      //Create the iframe and insert the site
      var iframe = document.createElement('iframe');
      iframe.setAttribute('id', 'iframe'+num_sites); // assign an id
      var el = document.getElementById('sites');
      el.appendChild(iframename);
      iframename.appendChild(iframe);
      iframe.setAttribute('src', site_path);
      iframe.setAttribute('height', '500');
      iframe.setAttribute('width', '100%');
  }

  function addSites() {
      if (sites.length != 0)
      {
          var element = document.getElementById("no-sites");
          element.parentNode.removeChild(element);
          sites.map(addSite);
      }
  }

  function shuffle(array) {
      for (var i = array.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var temp = array[i];
          array[i] = array[j];
          array[j] = temp;
      }
      console.log(array)
      return array;
  }

  var num_sites = 0;
  // Assign sites the the sites generated by ruby
  var sites = <%= create_sites_list %>;
  sites = shuffle(sites)
  window.onload = addSites;
</script>

<div class="container">
  <h1>Vote for Websites</h1>
</div>

<% if @user %>
  <div class = "container">
    <h2 id="no-sites">There are no websites uploaded yet :(</h2>
    <% if session[:flash] %>
        <p><%= display_flash(:flash) %></p>
    <% end %>
    <form action="/vote" method="post">
      <div  class="col-xs-2">
      <div class="form-group">
        <label for="vote-1">First Place:</label>
        <select class="form-control" id="vote-1" name="vote-1">
          <option selected="selected" value="" id="blank"></option>
        </select>
        <label for="vote-2">Second Place:</label>
        <select class="form-control" id="vote-2" name="vote-2">
          <option selected="selected" value="" id="blank"></option>
        </select>
        <label for="vote-3">Third Place:</label>
        <select class="form-control" id="vote-3" name="vote-3">
          <option selected="selected" value="" id="blank"></option>
        </select>
        <br>
        <input class="btn btn-primary" type="submit" value="Vote!">
      </div>
      </div>
    </form>
  </div>

  <div class = "container">
    <div id="sites"></div>

  </div>
<% else %>
  <div class="container">
    <h2>Not signed in.</h2>
    <p>Only logged in members may access this page. Please sign in.</p>
    <a href="/login" class="btn btn-success">Login</a>
  </div>
<% end %>